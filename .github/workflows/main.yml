name: Update Cloudflare DNS

on:
  schedule:
    - cron: '0 */6 * * *' # 每6小时自动运行一次
  workflow_dispatch:  # 手动触发

jobs:
  update-dns:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Run update script
      # *** 核心修改部分 ***
      run: |
        # 1. 清理 Secret 中的任何换行符或回车符。
        #    这是解决 "Invalid leading whitespace, reserved character(s), or return character(s)" 错误的关键。
        CLEAN_TOKEN=$(echo "${{ secrets.CF_API_TOKEN }}" | tr -d '\r\n')
        
        # 2. 将清理后的 Token 作为环境变量传递给 Python 脚本，并执行
        CF_API_TOKEN="${CLEAN_TOKEN}" python bestdomain.py --domains 38806827.xyz
      # *** 修改结束 ***
